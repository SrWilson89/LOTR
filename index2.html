<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG El Se√±or de los Anillos</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #333;
            color: white;
            font-family: Arial, sans-serif;
        }

        #game-container {
            position: relative;
            width: 90vw;
            height: 90vh;
            max-width: 800px;
            max-height: 800px;
            background-color: #222;
            border: 2px solid #444;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #1a1a2e, #16213e, #1a1a2e);
            position: relative;
            overflow: hidden;
        }

        #player {
            position: absolute;
            font-size: 24px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s ease;
            z-index: 100;
        }

        .enemy {
            position: absolute;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .enemy.troll { color: #8B4513; }
        .enemy.nazgul { color: #4A4A4A; }
        .enemy.boss { 
            color: #FF4500;
            font-size: 32px;
            text-shadow: 0 0 10px #FF0000;
        }

        .item {
            position: absolute;
            font-size: 24px;
            animation: float 2s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        #stats {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(27, 2, 216, 0.4);
            padding: 10px;
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }

        .stat-bar {
            width: 100px;
            height: 10px;
            background-color: #444;
            border-radius: 5px;
            margin-top: 5px;
        }

        .stat-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .health-bar { background-color: #ff4444; }
        .mana-bar { background-color: #4444ff; }
        .exp-bar { background-color: #44ff44; }

        #battle-log {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: calc(100% - 20px);
            height: 80px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px;
            overflow-y: auto;
            font-size: 12px;
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }

        #abilities {
            position: absolute;
            bottom: 100px;
            left: 10px;
            display: flex;
            gap: 10px;
        }

        .ability-btn {
            padding: 8px 16px;
            background-color: #2a2a2a;
            border: 1px solid #444;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ability-btn:hover:not(:disabled) {
            background-color: #3a3a3a;
            transform: scale(1.05);
        }

        .ability-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #active-effects {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }

        .effect-icon {
            display: inline-block;
            margin: 0 2px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        #game-over.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #respawn-btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        #respawn-btn:hover {
            background-color: #45a049;
            transform: scale(1.05);
        }

        /* Nuevos estilos para decorados */
        .decor {
            position: absolute;
            font-size: 24px;
            z-index: 50;
            transition: transform 0.3s ease;
        }

        .tree { 
            color: #2E8B57; 
            animation: sway 3s infinite ease-in-out;
        }

        .mountain { 
            color: #808080;
            font-size: 32px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .river { 
            color: #1E90FF;
            animation: flow 2s infinite linear;
        }

        .ruins {
            color: #8B8878;
            font-size: 28px;
            opacity: 0.8;
        }

        .hobbit-hole {
            color: #8B4513;
            font-size: 22px;
        }

        .tower {
            color: #FFFFFF;
            font-size: 30px;
            text-shadow: 0 0 5px #FFF;
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        @keyframes flow {
            0% { transform: translateX(-5px); }
            100% { transform: translateX(5px); }
        }

        /* Efecto de niebla */
        .fog {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.05);
            pointer-events: none;
            animation: fog-movement 20s infinite linear;
        }

        @keyframes fog-movement {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="map">
            <!-- Efecto de niebla -->
            <div class="fog"></div>
            
            <!-- √Årboles del Bosque Negro -->
            <div class="decor tree" style="top: 10%; left: 10%;">üå≥</div>
            <div class="decor tree" style="top: 20%; left: 30%;">üå≥</div>
            <div class="decor tree" style="top: 15%; left: 20%;">üå≤</div>
            <div class="decor tree" style="top: 25%; left: 15%;">üå≥</div>
            <div class="decor tree" style="top: 5%; left: 25%;">üå≤</div>
            
            <!-- Monta√±as Nubladas -->
            <div class="decor mountain" style="top: 5%; left: 70%;">‚õ∞Ô∏è</div>
            <div class="decor mountain" style="top: 8%; left: 75%;">üóª</div>
            <div class="decor mountain" style="top: 3%; left: 65%;">‚õ∞Ô∏è</div>
            
            <!-- R√≠o Anduin -->
            <div class="decor river" style="top: 80%; left: 50%;">üåä</div>
            <div class="decor river" style="top: 75%; left: 48%;">üíß</div>
            <div class="decor river" style="top: 85%; left: 52%;">üåä</div>
            
            <!-- Ruinas de civilizaciones antiguas -->
            <div class="decor ruins" style="top: 40%; left: 60%;">üèõÔ∏è</div>
            <div class="decor ruins" style="top: 45%; left: 65%;">üóø</div>
            
            <!-- Agujeros hobbit de la Comarca -->
            <div class="decor hobbit-hole" style="top: 30%; left: 40%;">üè†</div>
            <div class="decor hobbit-hole" style="top: 35%; left: 45%;">üè°</div>
            
            <!-- Torres de vigilancia -->
            <div class="decor tower" style="top: 60%; left: 20%;">üóº</div>
            <div class="decor tower" style="top: 55%; left: 80%;">üè∞</div>
        </div>
        <div id="player">üßù</div>
        <div id="stats">
            <div>Salud: <span id="health">100</span></div>
            <div class="stat-bar"><div id="health-fill" class="stat-fill health-bar"></div></div>
            <div>Man√°: <span id="mana">100</span></div>
            <div class="stat-bar"><div id="mana-fill" class="stat-fill mana-bar"></div></div>
            <div>Nivel: <span id="level">1</span></div>
            <div>EXP: <span id="exp">0</span>/<span id="exp-next">100</span></div>
            <div class="stat-bar"><div id="exp-fill" class="stat-fill exp-bar"></div></div>
            <div>Enemigos: <span id="enemies-defeated">0</span></div>
        </div>
        <div id="abilities">
            <button class="ability-btn" id="attack-btn">‚öîÔ∏è Ataque (0)</button>
            <button class="ability-btn" id="shield-btn">üõ°Ô∏è Escudo (20)</button>
        </div>
        <div id="active-effects"></div>
        <div id="battle-log"></div>
        <div id="game-over">
            <h2>¬°Game Over!</h2>
            <p>Nivel alcanzado: <span id="final-level">1</span></p>
            <p>Enemigos derrotados: <span id="final-enemies">0</span></p>
            <button id="respawn-btn">Reaparecer</button>
        </div>
    </div>

    <script>
        // Variables globales
        let playerHealth = 100;
        let playerMaxHealth = 100;
        let playerMana = 100;
        let playerMaxMana = 100;
        let playerLevel = 1;
        let playerExperience = 0;
        let experienceToNext = 100;
        let enemiesDefeated = 0;
        let playerDamage = 20;
        let activeEffects = new Set();
        let enemies = [];
        let inBattle = false;

        // Referencias DOM
        const player = document.getElementById('player');
        const healthDisplay = document.getElementById('health');
        const manaDisplay = document.getElementById('mana');
        const levelDisplay = document.getElementById('level');
        const expDisplay = document.getElementById('exp');
        const expNextDisplay = document.getElementById('exp-next');
        const enemiesDisplay = document.getElementById('enemies-defeated');
        const battleLog = document.getElementById('battle-log');
        const gameOver = document.getElementById('game-over');
        const attackBtn = document.getElementById('attack-btn');
        const shieldBtn = document.getElementById('shield-btn');
        const effectsDisplay = document.getElementById('active-effects');

        // Barras de estado
        const healthFill = document.getElementById('health-fill');
        const manaFill = document.getElementById('mana-fill');
        const expFill = document.getElementById('exp-fill');

        // Movimiento del jugador
        document.addEventListener('keydown', (e) => {
            if (inBattle) return;

            const speed = 10;
            let x = parseInt(player.style.left) || 400;
            let y = parseInt(player.style.top) || 400;

            switch(e.key) {
                case 'ArrowUp': y = Math.max(0, y - speed); break;
                case 'ArrowDown': y = Math.min(760, y + speed); break;
                case 'ArrowLeft': x = Math.max(0, x - speed); break;
                case 'ArrowRight': x = Math.min(760, x + speed); break;
            }

            player.style.left = x + 'px';
            player.style.top = y + 'px';

            checkCollisions();
        });

        // Habilidades
        attackBtn.addEventListener('click', () => useAbility('attack'));
        shieldBtn.addEventListener('click', () => useAbility('shield'));

        function useAbility(type) {
            if (inBattle) {
                if (type === 'attack' && !attackBtn.disabled) {
                    playerDamage *= 1.5;
                    addEffect('‚öîÔ∏è');
                    attackBtn.disabled = true;
                    setTimeout(() => {
                        playerDamage /= 1.5;
                        removeEffect('‚öîÔ∏è');
                        attackBtn.disabled = false;
                    }, 3000);
                }
                else if (type === 'shield' && !shieldBtn.disabled && playerMana >= 20) {
                    playerMana -= 20;
                    addEffect('üõ°Ô∏è');
                    shieldBtn.disabled = true;
                    setTimeout(() => {
                        removeEffect('üõ°Ô∏è');
                        shieldBtn.disabled = false;
                    }, 5000);
                    updateStats();
                }
            }
        }

        // Sistema de efectos
        function addEffect(effect) {
            activeEffects.add(effect);
            updateEffects();
        }

        function removeEffect(effect) {
            activeEffects.delete(effect);
            updateEffects();
        }

        function updateEffects() {
            effectsDisplay.innerHTML = Array.from(activeEffects)
                .map(effect => `<span class="effect-icon">${effect}</span>`)
                .join('');
        }

        // Actualizaci√≥n de estad√≠sticas
        function updateStats() {
            healthDisplay.textContent = Math.floor(playerHealth);
            manaDisplay.textContent = Math.floor(playerMana);
            levelDisplay.textContent = playerLevel;
            expDisplay.textContent = Math.floor(playerExperience);
            expNextDisplay.textContent = experienceToNext;
            enemiesDisplay.textContent = enemiesDefeated;

            // Actualizar barras
            healthFill.style.width = (playerHealth / playerMaxHealth * 100) + '%';
            manaFill.style.width = (playerMana / playerMaxMana * 100) + '%';
            expFill.style.width = (playerExperience / experienceToNext * 100) + '%';
        }

        // Sistema de batalla
        function startBattle(enemy) {
            inBattle = true;
            addToLog(`¬°Batalla contra ${enemy.type}!`);

            const battleInterval = setInterval(() => {
                if (!inBattle) {
                    clearInterval(battleInterval);
                    return;
                }

                // Ataque del jugador
                const damage = Math.random() < 0.2 ? playerDamage * 1.5 : playerDamage;
                enemy.health -= damage;
                addToLog(`Hiciste ${Math.floor(damage)} de da√±o${damage > playerDamage ? ' ¬°Cr√≠tico!' : ''}`);

                // Ataque del enemigo
                if (enemy.health > 0 && !activeEffects.has('üõ°Ô∏è')) {
                    playerHealth -= enemy.damage;
                    addToLog(`Recibes ${enemy.damage} de da√±o`);
                }

                updateStats();

                // Verificar condiciones de victoria/derrota
                if (playerHealth <= 0) {
                    endBattle(false);
                    showGameOver();
                    clearInterval(battleInterval);
                }
                else if (enemy.health <= 0) {
                    endBattle(true, enemy);
                    clearInterval(battleInterval);
                }
            }, 1000);
        }

        function endBattle(victory, enemy) {
            inBattle = false;
            if (victory) {
                enemiesDefeated++;
                gainExperience(enemy.expValue);
                enemies = enemies.filter(e => e !== enemy);
                enemy.element.remove();
                addToLog('¬°Victoria!');
                spawnEnemy(); // Spawn new enemy
            }
            updateStats();
        }

        // Sistema de experiencia y nivel
        function gainExperience(amount) {
            playerExperience += amount;
            while (playerExperience >= experienceToNext) {
                playerExperience -= experienceToNext;
                levelUp();
            }
            updateStats();
        }

        function levelUp() {
            playerLevel++;
            playerMaxHealth += 20;
            playerHealth = playerMaxHealth;
            playerMaxMana += 10;
            playerMana = playerMaxMana;
            playerDamage += 5;
            experienceToNext = Math.floor(experienceToNext * 1.2);
            addToLog(`¬°Subiste al nivel ${playerLevel}!`);
            updateStats();
        }

        // Creaci√≥n de enemigos
        function spawnEnemy() {
            const types = [
                { emoji: 'üëπ', name: 'Orco', health: 50, damage: 10, expValue: 20 },
                { emoji: 'üßå', name: 'Troll', health: 80, damage: 15, expValue: 30 },
                { emoji: 'üë§', name: 'Nazg√ªl', health: 100, damage: 20, expValue: 50 },
                { emoji: 'üêâ', name: 'Drag√≥n', health: 200, damage: 30, expValue: 100 }
            ];

            const enemyType = types[Math.floor(Math.random() * types.length)];
            const enemy = {
                ...enemyType,
                health: enemyType.health,
                element: document.createElement('div')
            };

            enemy.element.className = `enemy ${enemyType.name.toLowerCase()}`;
            enemy.element.textContent = enemyType.emoji;
            enemy.element.style.left = `${Math.random() * 700}px`;
            enemy.element.style.top = `${Math.random() * 700}px`;

            document.getElementById('map').appendChild(enemy.element);
            enemies.push(enemy);
        }

        // Colisiones
        function checkCollisions() {
            const playerRect = player.getBoundingClientRect();
            enemies.forEach(enemy => {
                const enemyRect = enemy.element.getBoundingClientRect();
                if (rectsIntersect(playerRect, enemyRect)) {
                    startBattle(enemy);
                }
            });
        }

        function rectsIntersect(rect1, rect2) {
            return !(
                rect1.right < rect2.left ||
                rect1.left > rect2.right ||
                rect1.bottom < rect2.top ||
                rect1.top > rect2.bottom
            );
        }

        // Sistema de registro de batalla
        function addToLog(message) {
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            battleLog.appendChild(logEntry);
            battleLog.scrollTop = battleLog.scrollHeight;
        }

        // Game Over
        function showGameOver() {
            document.getElementById('final-level').textContent = playerLevel;
            document.getElementById('final-enemies').textContent = enemiesDefeated;
            gameOver.classList.add('visible');
        }

        document.getElementById('respawn-btn').addEventListener('click', () => {
            playerHealth = playerMaxHealth;
            playerMana = playerMaxMana;
            playerExperience = 0;
            experienceToNext = 100;
            playerLevel = 1;
            enemiesDefeated = 0;
            playerDamage = 20;
            activeEffects.clear();
            enemies.forEach(enemy => enemy.element.remove());
            enemies = [];
            gameOver.classList.remove('visible');
            updateStats();
            spawnEnemy();
        });

        // Inicializaci√≥n del juego
        function initGame() {
            updateStats();
            spawnEnemy();
        }

        initGame();
    </script>
</body>
</html>